<!DOCTYPE html>
<html>
<head>
  <title>Sports Booking Form</title>
  
</head>

<body style="text-align: center; font-family: Poppins">

  <h1>Sports Booking Form</h1>

  <!-- FORM -->
  <form id="bookingForm" class="form">

    <label for="sport">Select Sport:</label><br>
    <select id="sport" name="sport" onchange="showTeamForm()" required>
      <option value="" selected disabled>Select a sport</option>
      <option value="cricket">Cricket</option>
      <option value="carrom">Carrom Board</option>
      <option value="badminton">Badminton</option>
      <option value="chess">Chess</option>
      <option value="tug_of_war">Tug of War</option>
      <option value="kho_kho">Kho Kho</option>
    </select><br><br>

    <!-- Dynamic team members -->
    <div id="teamFormContainer"></div>

    <label for="captain">Team Captain:</label><br>
    <input type="text" id="captain" required><br><br>

    <label for="className">Class / Section:</label><br>
    <input type="text" id="className" required><br><br>

    <label for="phone">Phone Number:</label><br>
    <input
      type="tel"
      id="phone"
      pattern="[0-9]{10}"
      maxlength="10"
      placeholder="Enter 10-digit number"
      oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,10)"
      required
    ><br><br>

    <input type="submit" id="submitBtn" value="Submit Booking">
    <p id="statusMsg" style="color: green;"></p>


  </form>

  <!-- SCRIPT -->
  <script>
    function showTeamForm() {
      const sport = document.getElementById("sport").value;
      const container = document.getElementById("teamFormContainer");

      container.innerHTML = "";
      if (!sport) return;

      const teamSizes = {
        cricket: 7,
        carrom: 2,
        badminton: 2,
        chess: 1,
        tug_of_war: 8,
        kho_kho: 9
      };

      const members = teamSizes[sport];

      const title = document.createElement("h3");
      title.innerText = `Enter ${members} Team Member(s)`;
      container.appendChild(title);

      for (let i = 1; i <= members; i++) {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Member ${i} Name`;
        input.required = true;
        input.style.display = "block";
        input.style.margin = "8px auto";
        container.appendChild(input);
      }
    }

  let isSubmitting = false; // ðŸ”’ lock to prevent multiple submits

  document.getElementById("bookingForm").addEventListener("submit", function (e) {
    e.preventDefault();

    if (isSubmitting) return; // ðŸš« block duplicate clicks
    isSubmitting = true;

    const submitBtn = document.getElementById("submitBtn");
    const statusMsg = document.getElementById("statusMsg");

    submitBtn.disabled = true;
    submitBtn.value = "Submitting...";
    statusMsg.innerText = "Please wait, submitting your booking...";

    const members = [];
    document.querySelectorAll("#teamFormContainer input").forEach(i => {
      members.push(i.value);
    });

    const data = {
      sport: document.getElementById("sport").value,
      class: document.getElementById("className").value,
      captain: document.getElementById("captain").value,
      phone: document.getElementById("phone").value,
      members: members,
      timestamp: new Date().toISOString() // ðŸ‘ˆ helpful for backend
    };

    fetch("https://script.google.com/macros/s/AKfycbw-_k_Gis74GikmjdWdIggm4YGJNUEbvfkeF2ar8Gwxolu0apNBF6uVIdYppAG1_NMw/exec", {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
    .then(() => {
      window.location.href = "success.html";
    })
    .catch(err => {
      alert("Submission failed. Please try again.");
      console.error(err);

      // ðŸ”“ unlock ONLY if failed
      isSubmitting = false;
      submitBtn.disabled = false;
      submitBtn.value = "Submit Booking";
      statusMsg.innerText = "";
    });
  });
</script>


</body>
</html>
